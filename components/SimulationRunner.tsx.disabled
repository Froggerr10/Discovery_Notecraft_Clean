// components/SimulationRunner.tsx
// Simulador para testar o Discovery com dados fict√≠cios
import React, { useState } from 'react';
import { ReportGenerator, CompanyProfile, AIInsight } from '@/lib/ai-prompts';
import { ConsultiveDiagnosisGenerator } from '@/lib/consultive-prompts';
import IntelligentDiagnosisEngine from '@/lib/intelligent-diagnosis-engine';
import { CRITICAL_SECTIONS_PROMPTS, ExecutiveReportGenerator } from '@/lib/critical-sections-prompts';

interface SimulationRunnerProps {
  onComplete?: (report: string) => void;
}

const FAKE_COMPANY: CompanyProfile = {
  name: "TributConsult Pro Ltda",
  size: "M√âDIA",
  maturity: "DIGITALIZANDO", 
  industry_focus: ["Consultoria Tribut√°ria", "RCT", "Planejamento Fiscal"],
  main_challenges: ["Processos manuais", "Falta de integra√ß√£o", "Demanda crescente"],
  ai_readiness: 45,
  automation_potential: 75
};

const FAKE_RESPONSES = {
  // Se√ß√£o 1: Escolha e Prioriza√ß√£o de Servi√ßos
  1: [
    ["RCT", "Planejamento", "Auditoria", "Consultoria", "Outros"], // Distribui√ß√£o de faturamento
    ["ICMS - diferencial espec√≠fico"], // Especialidade mais competitiva
    ["RCT - processos bem definidos", "Auditoria - checklists padr√£o"], // Padroniz√°veis
    ["Planejamento Tribut√°rio (Alto risco)", "Consultoria para Disputas (Alto risco)"], // Alto risco
    ["RCT", "Planejamento", "Auditoria"], // Expandir nos pr√≥ximos 2 anos
    ["Recupera√ß√£o de Cr√©ditos (aumentar volume)"] // Servi√ßo para expandir
  ],

  // Se√ß√£o 3: Vis√£o de Automa√ß√£o e IA  
  3: [
    ["Planilhas com macros/f√≥rmulas avan√ßadas", "Gera√ß√£o autom√°tica de relat√≥rios"], // Processos automatizados
    ["ChatGPT para pesquisas/textos", "Google Gemini/Bard"], // Ferramentas IA testadas
    ["Triagem inicial de documentos", "C√°lculos tribut√°rios repetitivos", "Pesquisa em bases legais"], // Candidatas √† automa√ß√£o
    ["Custo muito alto de implementa√ß√£o"], // Maior receio
    ["Redu√ß√£o de tempo por caso", "Maior precis√£o/menos erros", "Aumento de escala/volume de casos"], // Ganhos esperados
    ["Receptiva, mas com algumas preocupa√ß√µes"], // Rea√ß√£o da equipe
    ["S√≥cio/Diretor seria o champion do projeto"], // Sponsor interno
    ["ROI demonstrado em 12 meses"] // Crit√©rio para aprovar
  ],

  // Se√ß√£o 16: Agentes Comerciais Principais
  16: [
    ["Muito √∫til para alcan√ßar grandes empresas"], // BDR Virtual
    ["Game-changer para nossa opera√ß√£o"], // SDR Virtual
    ["√ötil para casos mais simples"], // Closer Virtual  
    ["√ötil para comunica√ß√µes de rotina"], // Customer Success Virtual
    ["BDR Virtual Especializado", "SDR Virtual", "Customer Success Virtual", "Closer Virtual"] // Sequ√™ncia ideal
  ]
};

const FAKE_OBSERVATIONS = {
  1: [
    "Atualmente RCT representa 60% do nosso faturamento, mas queremos diversificar",
    "Somos reconhecidos no mercado por nossa expertise em ICMS, especialmente no setor industrial",
    "Temos processos bem definidos para RCT e auditoria, mas planejamento ainda √© muito artesanal",
    "Planejamento tribut√°rio sempre requer revis√£o de s√≥cio devido ao risco, isso gera gargalo",
    "Mercado de RCT est√° aquecido, mas margem est√° sendo pressionada pela concorr√™ncia",
    "Queremos aumentar participa√ß√£o em planejamento porque tem margem melhor"
  ],
  3: [
    "Usamos muito Excel com macros complexas, mas ainda temos muitos processos manuais",
    "Testamos ChatGPT informalmente para pesquisas, resultados foram surpreendentes",
    "Triagem de documentos fiscais consome muito tempo da equipe j√∫nior",
    "Principal receio √© custo alto sem garantia de ROI no curto prazo",
    "Esperamos principalmente reduzir tempo dos processos manuais repetitivos",
    "Equipe est√° curiosa mas tem receio de perder emprego",
    "S√≥cio-diretor j√° demonstrou interesse em liderar iniciativas de inova√ß√£o",
    "Precisamos ver ROI em 12 meses para justificar o investimento"
  ],
  16: [
    "BDR virtual seria muito √∫til para prospectar grandes empresas industriais",
    "SDR 24h seria game-changer, perdemos muitos leads fora do hor√°rio comercial",
    "Closer virtual talvez s√≥ para casos mais simples, fechamento ainda precisa do humano",
    "CS virtual para follow-up seria perfeito, hoje fazemos pouco acompanhamento",
    "Sequ√™ncia: BDR primeiro (grandes contas), depois SDR (volume), depois CS (reten√ß√£o)"
  ]
};

export const SimulationRunner: React.FC<SimulationRunnerProps> = ({ onComplete }) => {
  const [isRunning, setIsRunning] = useState(false);
  const [progress, setProgress] = useState(0);
  const [currentStep, setCurrentStep] = useState('');
  const [generatedInsights, setGeneratedInsights] = useState<AIInsight[]>([]);
  const [finalReport, setFinalReport] = useState<string>('');

  const runSimulation = async () => {
    setIsRunning(true);
    setProgress(0);
    
    try {
      // Simula√ß√£o das se√ß√µes cr√≠ticas
      const sections = [1, 3, 16];
      const insights: AIInsight[] = [];
      
      for (let sectionIndex = 0; sectionIndex < sections.length; sectionIndex++) {
        const sectionId = sections[sectionIndex];
        setCurrentStep(`Processando Se√ß√£o ${sectionId}...`);
        
        const responses = FAKE_RESPONSES[sectionId as keyof typeof FAKE_RESPONSES];
        const observations = FAKE_OBSERVATIONS[sectionId as keyof typeof FAKE_OBSERVATIONS];
        
        // Gera insights para cada quest√£o da se√ß√£o
        for (let questionIndex = 0; questionIndex < responses.length; questionIndex++) {
          const questionId = sectionId * 10 + questionIndex + 1; // ID fict√≠cio
          
          // Simula gera√ß√£o de insight com delay realista
          await new Promise(resolve => setTimeout(resolve, 500));
          
          const insight: AIInsight = {
            question_id: questionId,
            section_id: sectionId,
            response: responses[questionIndex],
            observations: observations[questionIndex],
            ai_analysis: {
              complexity_score: Math.floor(Math.random() * 5) + 5, // 5-10
              strategic_importance: sectionId === 1 ? 9 : sectionId === 3 ? 8 : 7,
              automation_potential: Math.floor(Math.random() * 4) + 6, // 6-10
              risk_level: sectionId === 3 ? 7 : Math.floor(Math.random() * 3) + 4,
              insights: generateInsights(sectionId, responses[questionIndex], observations[questionIndex]),
              recommendations: generateRecommendations(sectionId, questionIndex),
              red_flags: generateRedFlags(sectionId, responses[questionIndex]),
              opportunities: generateOpportunities(sectionId, questionIndex)
            }
          };
          
          insights.push(insight);
          
          // Atualiza progresso
          const totalQuestions = sections.reduce((acc, sid) => 
            acc + FAKE_RESPONSES[sid as keyof typeof FAKE_RESPONSES].length, 0);
          const currentProgress = ((sectionIndex * responses.length + questionIndex + 1) / totalQuestions) * 80;
          setProgress(currentProgress);
        }
      }
      
      setGeneratedInsights(insights);
      setCurrentStep('Aplicando metodologias avan√ßadas de Discovery...');
      setProgress(85);
      
      // Aplica frameworks de consultoria para se√ß√µes cr√≠ticas
      await new Promise(resolve => setTimeout(resolve, 1000));
      
      const criticalAnalyses: any = {};
      
      // An√°lise Se√ß√£o 1 - Portfolio de Servi√ßos
      const section1Responses = FAKE_RESPONSES[1];
      const section1Observations = FAKE_OBSERVATIONS[1];
      criticalAnalyses.section1 = await simulateAdvancedPrompt(
        CRITICAL_SECTIONS_PROMPTS.section_1_service_portfolio(section1Responses, section1Observations)
      );
      
      // An√°lise Se√ß√£o 3 - Automa√ß√£o e IA  
      const section3Responses = FAKE_RESPONSES[3];
      const section3Observations = FAKE_OBSERVATIONS[3];
      criticalAnalyses.section3 = await simulateAdvancedPrompt(
        CRITICAL_SECTIONS_PROMPTS.section_3_ai_automation(section3Responses, section3Observations)
      );
      
      // An√°lise Se√ß√£o 16 - Agentes Comerciais
      const section16Responses = FAKE_RESPONSES[16];
      const section16Observations = FAKE_OBSERVATIONS[16];
      criticalAnalyses.section16 = await simulateAdvancedPrompt(
        CRITICAL_SECTIONS_PROMPTS.section_16_sales_agents(section16Responses, section16Observations)
      );
      
      setProgress(95);
      setCurrentStep('Gerando diagn√≥stico consultivo inteligente...');
      
      // Gera diagn√≥stico m√©dico empresarial com detec√ß√£o de nuances
      await new Promise(resolve => setTimeout(resolve, 2000));
      
      const consultiveReport = IntelligentDiagnosisEngine.generateIntelligentDiagnosis(
        {
          1: FAKE_RESPONSES[1],
          3: FAKE_RESPONSES[3], 
          16: FAKE_RESPONSES[16]
        },
        {
          1: FAKE_OBSERVATIONS[1],
          3: FAKE_OBSERVATIONS[3],
          16: FAKE_OBSERVATIONS[16]
        },
        FAKE_COMPANY
      );
      
      // Gera diagn√≥sticos por se√ß√£o usando nova estrutura
      const sectionDiagnoses = [
        {
          section_id: 1,
          section_title: "Portf√≥lio de Servi√ßos",
          methodology: "Matriz de Potencial de Automa√ß√£o McKinsey",
          methodology_source: "mckinsey.com/capabilities/operations/our-insights/automation-potential",
          ai_aware_score: 3,
          status: "CR√çTICO",
          current_situation: "Nossa equipe observa que 60% do faturamento concentra-se em Recupera√ß√£o de Cr√©ditos Tribut√°rios executados atrav√©s de processos padronizados, por√©m totalmente manuais. A empresa processa 200 casos de RCT mensalmente, sendo que cada caso consome em m√©dia 4 horas de trabalho especializado. Observamos que 70% dessas atividades seguem roteiros id√™nticos de triagem documental e preenchimento de planilhas.",
          ai_implementation_opportunity: "Com base neste diagn√≥stico, projetamos que a automa√ß√£o via Robotic Process Automation (tecnologia que replica a√ß√µes humanas no computador) pode reduzir 80% do tempo manual nestes processos. Isso significa transformar 4 horas por caso em 48 minutos, liberando 320 horas mensais da equipe especializada.",
          attention_points: "Identificamos que sem implementa√ß√£o de automa√ß√£o, a empresa enfrentar√° press√£o crescente nos custos operacionais. Com o aumento natural da demanda, ser√° necess√°rio expandir significativamente a equipe para manter o mesmo n√≠vel de atendimento. Segundo estudo da Deloitte de 2024, consultorias que mant√™m processos manuais enfrentam redu√ß√£o gradual de competitividade de pre√ßos."
        },
        {
          section_id: 3,
          section_title: "Automa√ß√£o e Intelig√™ncia Artificial",
          methodology: "Framework de Maturidade Digital MIT",
          methodology_source: "[FONTE A VALIDAR - MIT Digital Maturity Assessment]",
          ai_aware_score: 7,
          status: "PRONTO PARA EVOLU√á√ÉO",
          current_situation: "Nossa an√°lise revela uma empresa em est√°gio intermedi√°rio-avan√ßado de maturidade digital. A equipe j√° utiliza macros avan√ßadas no Excel e testou informalmente ferramentas de Intelig√™ncia Artificial como ChatGPT para pesquisas tribut√°rias. Identificamos cultura organizacional receptiva √† inova√ß√£o, com lideran√ßa disposta a patrocinar projetos de transforma√ß√£o digital.",
          ai_implementation_opportunity: "Projetamos implementa√ß√£o bem-sucedida de Intelig√™ncia Artificial em pesquisa tribut√°ria e triagem documental. A empresa possui infraestrutura tecnol√≥gica adequada e equipe capacitada para absorver essas tecnologias. Estimamos redu√ß√£o de 40% no tempo de pesquisa jur√≠dica e elimina√ß√£o de 90% dos erros de triagem documental.",
          attention_points: "A janela de oportunidade para lideran√ßa em automa√ß√£o tribut√°ria est√° se fechando rapidamente. Concorrentes que implementarem Intelig√™ncia Artificial primeiro ganhar√£o vantagem competitiva permanente em velocidade de entrega e precis√£o t√©cnica."
        },
        {
          section_id: 16,
          section_title: "Agentes Comerciais Inteligentes",
          methodology: "Matriz de Capacidade Comercial Harvard Business Review",
          methodology_source: "hbr.org/sales-automation-capability-matrix",
          ai_aware_score: 5,
          status: "POTENCIAL MODERADO",
          current_situation: "Identificamos uma opera√ß√£o comercial tradicional com forte depend√™ncia de relacionamento pessoal e networking. A empresa demonstra interesse estrat√©gico em agentes virtuais para prospec√ß√£o de grandes contas industriais, alinhado com sua especializa√ß√£o em ICMS. Observamos que 60% das oportunidades comerciais surgem fora do hor√°rio comercial.",
          ai_implementation_opportunity: "Nossa proje√ß√£o indica que a implementa√ß√£o faseada de agentes comerciais inteligentes pode aumentar em 50% o pipeline de oportunidades qualificadas. Recomendamos iniciar com Business Development Representative (BDR) virtual para grandes contas, seguido por Sales Development Representative (SDR) 24 horas para captura de leads.",
          attention_points: "O modelo comercial atual limita o crescimento aos hor√°rios e capacidade humana da equipe. Sem automatiza√ß√£o comercial, a empresa enfrentar√° gargalo de crescimento significativo."
        }
      ];

      const enhancedReport = `# DISCOVERY IA-AWARE - DIAGN√ìSTICO EMPRESARIAL 360¬∞
**Equipe de Especialistas Notecraft**

## INTRODU√á√ÉO

Nossa equipe de especialistas Notecraft realizou uma an√°lise Discovery IA-Aware completa dos cen√°rios empresariais da TributConsult Pro. Atrav√©s da nossa metodologia de diagn√≥stico 360¬∞, mapeamos a **situa√ß√£o atual**, projetamos **oportunidades de implementa√ß√£o** e identificamos **pontos de aten√ß√£o**. Este relat√≥rio apresenta nosso diagn√≥stico por se√ß√£o estrat√©gica.

---

${sectionDiagnoses.map(diag => `
## SE√á√ÉO ${diag.section_id}: ${diag.section_title.toUpperCase()}

**METODOLOGIA DE DIAGN√ìSTICO**
Nossa equipe aplicou a **${diag.methodology}**. Esta metodologia √© utilizada por consultorias globais l√≠deres para identificar oportunidades de transforma√ß√£o digital [fonte: ${diag.methodology_source}].

**DIAGN√ìSTICO IA-AWARE: ${diag.ai_aware_score}/10 - ${diag.status}**

**SITUA√á√ÉO ATUAL IDENTIFICADA**
${diag.current_situation}

**OPORTUNIDADE DE IMPLEMENTA√á√ÉO DE IA**
${diag.ai_implementation_opportunity}

**PONTOS DE ATEN√á√ÉO**
${diag.attention_points}

---
`).join('')}

## CONSOLIDA√á√ÉO FINAL

**SCORE TOTAL DISCOVERY: 5.0/10**
**VEREDICTO GERAL: INTERMEDI√ÅRIO COM ALTO POTENCIAL**

**PRIORIZA√á√ÉO ESTRAT√âGICA**
Nossa equipe recomenda a seguinte ordem de implementa√ß√£o baseada no princ√≠pio 80/20:

‚ñ™ **PRIORIDADE 1:** Se√ß√£o 1 (Portf√≥lio de Servi√ßos) - Score cr√≠tico 3/10 indica m√°ximo potencial de automa√ß√£o com retorno imediato
‚ñ™ **PRIORIDADE 2:** Se√ß√£o 3 (Automa√ß√£o e IA) - Score 7/10 mostra prontid√£o cultural para implementa√ß√£o tecnol√≥gica
‚ñ™ **PRIORIDADE 3:** Se√ß√£o 16 (Agentes Comerciais) - Score 5/10 sugere implementa√ß√£o faseada ap√≥s consolida√ß√£o dos processos internos

**SUM√ÅRIO EXECUTIVO**
Nossa an√°lise identifica TributConsult Pro como uma consultoria tribut√°ria em transi√ß√£o digital com alto potencial de transforma√ß√£o. A concentra√ß√£o de 60% do faturamento em processos manuais padronizados de RCT representa a oportunidade mais imediata, com potencial de redu√ß√£o de 80% no tempo de processamento atrav√©s de automa√ß√£o. A cultura organizacional receptiva √† inova√ß√£o, evidenciada pelo uso experimental de ferramentas de IA, facilita a implementa√ß√£o tecnol√≥gica. Recomendamos abordagem faseada iniciando pela automa√ß√£o de RCT, seguida pela implementa√ß√£o de IA em pesquisa tribut√°ria e, posteriormente, agentes comerciais inteligentes para escalabilidade.

---

*Relat√≥rio gerado pela equipe de especialistas Notecraft - ${new Date().toLocaleDateString('pt-BR')}*

**METODOLOGIAS APLICADAS:**
‚ñ™ Matriz de Potencial McKinsey
‚ñ™ Framework de Maturidade Digital MIT  
‚ñ™ Matriz de Capacidade Comercial Harvard Business Review

*Discovery Notecraft‚Ñ¢ - Intelig√™ncia Consultiva IA-Aware*
`;

      setFinalReport(enhancedReport);
      setProgress(100);
      setCurrentStep('Simula√ß√£o conclu√≠da!');
      
      onComplete?.(enhancedReport);
      
    } catch (error) {
      console.error('Erro na simula√ß√£o:', error);
      setCurrentStep('Erro na simula√ß√£o');
    } finally {
      setIsRunning(false);
    }
  };

  return (
    <div className="max-w-4xl mx-auto p-6">
      <div className="backdrop-blur-md bg-white/10 border border-white/20 rounded-2xl p-8">
        <div className="text-center mb-8">
          <h2 className="text-3xl font-bold text-white mb-4">
            üß™ Simula√ß√£o Discovery Notecraft‚Ñ¢
          </h2>
          <p className="text-slate-300">
            Teste o sistema com dados fict√≠cios da empresa "TributConsult Pro Ltda"
          </p>
        </div>

        {!isRunning && !finalReport && (
          <div className="text-center">
            <button
              onClick={runSimulation}
              className="bg-gradient-to-r from-teal-400 to-emerald-400 text-slate-900 px-8 py-4 rounded-xl font-bold text-lg hover:shadow-lg hover:scale-105 transition-all"
            >
              üöÄ Iniciar Simula√ß√£o
            </button>
          </div>
        )}

        {isRunning && (
          <div className="space-y-6">
            <div className="text-center">
              <div className="text-teal-400 text-xl font-semibold mb-2">
                {currentStep}
              </div>
              <div className="w-full bg-slate-700 rounded-full h-4">
                <div 
                  className="bg-gradient-to-r from-teal-400 to-emerald-400 h-4 rounded-full transition-all duration-500"
                  style={{ width: `${progress}%` }}
                />
              </div>
              <div className="text-slate-400 mt-2">{Math.round(progress)}% conclu√≠do</div>
            </div>
            
            <div className="grid grid-cols-3 gap-4 text-center">
              <div className="bg-slate-800/50 p-4 rounded-lg">
                <div className="text-2xl font-bold text-teal-400">{generatedInsights.length}</div>
                <div className="text-slate-400">Insights Gerados</div>
              </div>
              <div className="bg-slate-800/50 p-4 rounded-lg">
                <div className="text-2xl font-bold text-emerald-400">
                  {Math.round(generatedInsights.reduce((acc, curr) => 
                    acc + curr.ai_analysis.automation_potential, 0) / Math.max(generatedInsights.length, 1))}
                </div>
                <div className="text-slate-400">Potencial IA M√©dio</div>
              </div>
              <div className="bg-slate-800/50 p-4 rounded-lg">
                <div className="text-2xl font-bold text-purple-400">3</div>
                <div className="text-slate-400">Se√ß√µes Cr√≠ticas</div>
              </div>
            </div>
          </div>
        )}

        {finalReport && (
          <div className="space-y-6">
            <div className="text-center">
              <div className="text-2xl font-bold text-emerald-400 mb-4">
                ‚úÖ Simula√ß√£o Conclu√≠da com Sucesso!
              </div>
              <div className="grid grid-cols-5 gap-4 mb-6">
                <div className="bg-emerald-900/30 p-4 rounded-lg">
                  <div className="text-2xl font-bold text-emerald-400">{generatedInsights.length}</div>
                  <div className="text-emerald-300">Insights Gerados</div>
                </div>
                <div className="bg-teal-900/30 p-4 rounded-lg">
                  <div className="text-2xl font-bold text-teal-400">
                    {Math.round(FAKE_COMPANY.automation_potential)}%
                  </div>
                  <div className="text-teal-300">Potencial de Automa√ß√£o</div>
                </div>
                <div className="bg-purple-900/30 p-4 rounded-lg">
                  <div className="text-2xl font-bold text-purple-400">
                    {Math.round(FAKE_COMPANY.ai_readiness)}%
                  </div>
                  <div className="text-purple-300">Prontid√£o para IA</div>
                </div>
                <div className="bg-blue-900/30 p-4 rounded-lg">
                  <div className="text-2xl font-bold text-blue-400">3</div>
                  <div className="text-blue-300">Se√ß√µes Analisadas</div>
                </div>
                <div className="bg-orange-900/30 p-4 rounded-lg">
                  <div className="text-2xl font-bold text-orange-400">15+</div>
                  <div className="text-orange-300">Fontes Validadas</div>
                </div>
              </div>
            </div>

            <div className="bg-slate-800/50 rounded-xl p-6">
              <h3 className="text-xl font-bold text-white mb-4 flex items-center">
                üìä Relat√≥rio Executivo Gerado
              </h3>
              <div className="bg-slate-900/50 p-4 rounded-lg max-h-96 overflow-y-auto">
                <pre className="text-slate-300 text-sm whitespace-pre-wrap font-mono">
                  {finalReport}
                </pre>
              </div>
            </div>

            <div className="flex gap-4 justify-center">
              <button
                onClick={() => {
                  setFinalReport('');
                  setGeneratedInsights([]);
                  setProgress(0);
                }}
                className="bg-slate-700 text-white px-6 py-3 rounded-lg hover:bg-slate-600 transition-all"
              >
                üîÑ Nova Simula√ß√£o
              </button>
              <button
                onClick={() => {
                  navigator.clipboard.writeText(finalReport);
                  alert('Relat√≥rio copiado para √°rea de transfer√™ncia!');
                }}
                className="bg-gradient-to-r from-teal-400 to-emerald-400 text-slate-900 px-6 py-3 rounded-lg font-bold hover:shadow-lg transition-all"
              >
                üìã Copiar Relat√≥rio
              </button>
            </div>
          </div>
        )}
      </div>
    </div>
  );
};

// Fun√ß√µes auxiliares para gerar insights realistas
function generateInsights(sectionId: number, response: any, observation: string): string[] {
  const insights = [];
  
  if (sectionId === 1) {
    insights.push("Concentra√ß√£o em RCT indica maturidade operacional mas risco de depend√™ncia");
    if (observation.includes("diversificar")) {
      insights.push("Estrat√©gia de diversifica√ß√£o alinhada com melhores pr√°ticas de mercado");
    }
  }
  
  if (sectionId === 3) {
    insights.push("Uso de Excel avan√ßado indica potencial para automa√ß√£o RPA");
    if (observation.includes("ChatGPT")) {
      insights.push("Experimenta√ß√£o com IA demonstra abertura para inova√ß√£o");
    }
  }
  
  if (sectionId === 16) {
    insights.push("Interesse em agentes comerciais indica vis√£o de escala via tecnologia");
  }
  
  return insights;
}

// Simula execu√ß√£o de prompt avan√ßado
function simulateAdvancedPrompt(prompt: string): Promise<any> {
  return new Promise(resolve => {
    setTimeout(() => {
      resolve({
        analysis_completed: true,
        methodology_applied: 'Framework consultoria l√≠der',
        confidence_level: 'HIGH',
        sources_validated: Math.floor(Math.random() * 5) + 3,
        key_insights: [
          'Oportunidade significativa identificada',
          'ROI positivo confirmado com benchmarks validados',
          'Implementa√ß√£o vi√°vel seguindo metodologia comprovada'
        ],
        prompt_preview: prompt.substring(0, 150) + '...'
      });
    }, 800);
  });
}

function generateRecommendations(sectionId: number, questionIndex: number): string[] {
  const recommendations = [];
  
  if (sectionId === 1) {
    recommendations.push("Implementar automa√ß√£o nos processos RCT padronizados");
    recommendations.push("Desenvolver ofertas de planejamento como diferencial premium");
  }
  
  if (sectionId === 3) {
    recommendations.push("Iniciar PoC com RPA em triagem de documentos");
    recommendations.push("Capacitar equipe em ferramentas de IA generativa");
  }
  
  if (sectionId === 16) {
    recommendations.push("Priorizar BDR virtual para captura de grandes contas");
    recommendations.push("Implementar SDR 24h para aumento de convers√£o");
  }
  
  return recommendations;
}

function generateRedFlags(sectionId: number, response: any): string[] {
  const flags = [];
  
  if (sectionId === 3) {
    flags.push("Receio de custo alto pode limitar investimento inicial");
  }
  
  return flags;
}

function generateOpportunities(sectionId: number, questionIndex: number): string[] {
  const opportunities = [];
  
  if (sectionId === 1) {
    opportunities.push("Automa√ß√£o de RCT para redu√ß√£o de custos");
    opportunities.push("Premium pricing em planejamento tribut√°rio");
  }
  
  if (sectionId === 3) {
    opportunities.push("ROI r√°pido com automa√ß√£o de tarefas repetitivas");
    opportunities.push("Diferencia√ß√£o via IA na pesquisa tribut√°ria");
  }
  
  if (sectionId === 16) {
    opportunities.push("Escala comercial via agentes inteligentes");
    opportunities.push("Melhoria na experi√™ncia do cliente com CS automatizado");
  }
  
  return opportunities;
}

export default SimulationRunner;